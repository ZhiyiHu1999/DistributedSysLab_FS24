GPU 0: NVIDIA GeForce RTX 3090 (UUID: GPU-c2927e9a-08b2-a1cd-17a1-092a418bac6e)
GPU 1: NVIDIA GeForce RTX 3090 (UUID: GPU-9d7f82f3-c503-8ee9-26f2-424ddefe47e2)
GPU 2: NVIDIA GeForce RTX 3090 (UUID: GPU-96b59d15-054d-c99f-68bf-406414f8d051)
GPU 0: NVIDIA GeForce RTX 3090 (UUID: GPU-cdb8590d-7b7f-deec-f4f5-8c132c2bbfed)
GPU 1: NVIDIA GeForce RTX 3090 (UUID: GPU-4bab2c5f-3d91-e162-3057-f8068c36d803)
GPU 2: NVIDIA GeForce RTX 3090 (UUID: GPU-f5a5d6fc-28e6-6fda-a6fe-0c13357c69bb)
Master Address: 148.187.105.53
Master Port: 29500
Master Address: 148.187.105.53
Master Port: 29500
Node Rank: 1
Node Rank: 0
[2024-10-14 00:53:52,416] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-10-14 00:53:52,427] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-10-14 00:53:54,895] [INFO] [runner.py:607:main] cmd = /users/zhu/anaconda3/bin/python -u -m deepspeed.launcher.launch --world_info=eyJhdWx0NDMuY3Njcy5jaCI6IFswXSwgImF1bHQ0NC5jc2NzLmNoIjogWzBdfQ== --master_addr=148.187.105.53 --master_port=29500 --node_rank=0 --enable_each_rank_log=None train_bert_ds.py --checkpoint_dir /users/zhu/DeepSpeedExamples/training/HelloDeepSpeed/experiment_deepspeed
[2024-10-14 00:53:54,947] [INFO] [runner.py:607:main] cmd = /users/zhu/anaconda3/bin/python -u -m deepspeed.launcher.launch --world_info=eyJhdWx0NDMuY3Njcy5jaCI6IFswXSwgImF1bHQ0NC5jc2NzLmNoIjogWzBdfQ== --master_addr=148.187.105.53 --master_port=29500 --node_rank=1 --enable_each_rank_log=None train_bert_ds.py --checkpoint_dir /users/zhu/DeepSpeedExamples/training/HelloDeepSpeed/experiment_deepspeed
[2024-10-14 00:53:56,749] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-10-14 00:53:56,819] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-10-14 00:53:59,185] [INFO] [launch.py:139:main] 0 NCCL_GRAPH_DUMP_FILE=./results/Graph.txt
[2024-10-14 00:53:59,185] [INFO] [launch.py:139:main] 0 NCCL_TOPO_DUMP_FILE=./results/Topology_Intra_Node.txt
[2024-10-14 00:53:59,185] [INFO] [launch.py:139:main] 0 NCCL_DEBUG=INFO
[2024-10-14 00:53:59,185] [INFO] [launch.py:146:main] WORLD INFO DICT: {'ault43.cscs.ch': [0], 'ault44.cscs.ch': [0]}
[2024-10-14 00:53:59,185] [INFO] [launch.py:152:main] nnodes=2, num_local_procs=1, node_rank=0
[2024-10-14 00:53:59,185] [INFO] [launch.py:163:main] global_rank_mapping=defaultdict(<class 'list'>, {'ault43.cscs.ch': [0], 'ault44.cscs.ch': [1]})
[2024-10-14 00:53:59,185] [INFO] [launch.py:164:main] dist_world_size=2
[2024-10-14 00:53:59,185] [INFO] [launch.py:168:main] Setting CUDA_VISIBLE_DEVICES=0
[2024-10-14 00:53:59,186] [INFO] [launch.py:256:main] process 1021351 spawned with command: ['/users/zhu/anaconda3/bin/python', '-u', 'train_bert_ds.py', '--local_rank=0', '--checkpoint_dir', '/users/zhu/DeepSpeedExamples/training/HelloDeepSpeed/experiment_deepspeed']
[2024-10-14 00:53:59,318] [INFO] [launch.py:139:main] 1 NCCL_GRAPH_DUMP_FILE=./results/Graph.txt
[2024-10-14 00:53:59,318] [INFO] [launch.py:139:main] 1 NCCL_TOPO_DUMP_FILE=./results/Topology_Intra_Node.txt
[2024-10-14 00:53:59,318] [INFO] [launch.py:139:main] 1 NCCL_DEBUG=INFO
[2024-10-14 00:53:59,318] [INFO] [launch.py:146:main] WORLD INFO DICT: {'ault43.cscs.ch': [0], 'ault44.cscs.ch': [0]}
[2024-10-14 00:53:59,318] [INFO] [launch.py:152:main] nnodes=2, num_local_procs=1, node_rank=1
[2024-10-14 00:53:59,318] [INFO] [launch.py:163:main] global_rank_mapping=defaultdict(<class 'list'>, {'ault43.cscs.ch': [0], 'ault44.cscs.ch': [1]})
[2024-10-14 00:53:59,318] [INFO] [launch.py:164:main] dist_world_size=2
[2024-10-14 00:53:59,318] [INFO] [launch.py:168:main] Setting CUDA_VISIBLE_DEVICES=0
[2024-10-14 00:53:59,318] [INFO] [launch.py:256:main] process 1048853 spawned with command: ['/users/zhu/anaconda3/bin/python', '-u', 'train_bert_ds.py', '--local_rank=0', '--checkpoint_dir', '/users/zhu/DeepSpeedExamples/training/HelloDeepSpeed/experiment_deepspeed']
[2024-10-14 00:54:02,539] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-10-14 00:54:02,743] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-10-14 00:54:10,771] [INFO] [logging.py:96:log_dist] [Rank -1] DeepSpeed info: version=0.15.2, git-hash=unknown, git-branch=unknown
[2024-10-14 00:54:10,771] [INFO] [comm.py:652:init_distributed] cdb=None
[2024-10-14 00:54:11,075] [INFO] [logging.py:96:log_dist] [Rank -1] DeepSpeed info: version=0.15.2, git-hash=unknown, git-branch=unknown
[2024-10-14 00:54:11,075] [INFO] [comm.py:652:init_distributed] cdb=None
[2024-10-14 00:54:11,075] [INFO] [comm.py:683:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[2024-10-14 00:54:11,773] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 2
[2024-10-14 00:54:11,776] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 2
ault43:1021351:1021351 [0] NCCL INFO Bootstrap : Using ib0:192.168.0.43<0>
ault43:1021351:1021351 [0] NCCL INFO NET/Plugin : dlerror=libnccl-net.so: cannot open shared object file: No such file or directory No plugin found (libnccl-net.so), using internal implementation
ault43:1021351:1021351 [0] NCCL INFO cudaDriverVersion 12010
NCCL version 2.20.5+cuda11.8
ault44:1048853:1048853 [0] NCCL INFO cudaDriverVersion 12010
ault44:1048853:1048853 [0] NCCL INFO Bootstrap : Using ib0:192.168.0.44<0>
ault44:1048853:1048853 [0] NCCL INFO NET/Plugin : dlerror=libnccl-net.so: cannot open shared object file: No such file or directory No plugin found (libnccl-net.so), using internal implementation
ault44:1048853:1048901 [0] NCCL INFO NET/IB : Using [0]mlx5_0:1/IB [1]mlx5_1:1/RoCE [RO]; OOB ib0:192.168.0.44<0>
ault44:1048853:1048901 [0] NCCL INFO Using non-device net plugin version 0
ault44:1048853:1048901 [0] NCCL INFO Using network IB
ault43:1021351:1021412 [0] NCCL INFO NET/IB : Using [0]mlx5_0:1/IB [1]mlx5_1:1/RoCE [RO]; OOB ib0:192.168.0.43<0>
ault43:1021351:1021412 [0] NCCL INFO Using non-device net plugin version 0
ault43:1021351:1021412 [0] NCCL INFO Using network IB
ault43:1021351:1021412 [0] NCCL INFO comm 0xbb4d540 rank 0 nranks 2 cudaDev 0 nvmlDev 0 busId 41000 commId 0x5d908c13e099cb61 - Init START
ault44:1048853:1048901 [0] NCCL INFO comm 0xbb4a490 rank 1 nranks 2 cudaDev 0 nvmlDev 0 busId 41000 commId 0x5d908c13e099cb61 - Init START
ault43:1021351:1021412 [0] NCCL INFO NCCL_TOPO_DUMP_FILE set by environment to ./results/Topology_Intra_Node.txt

ault43:1021351:1021412 [0] graph/xml.cc:244 NCCL WARN Unable to open ./results/Topology_Intra_Node.txt, not dumping topology.
ault43:1021351:1021412 [0] NCCL INFO NCCL_GRAPH_DUMP_FILE set by environment to ./results/Graph.txt

ault43:1021351:1021412 [0] graph/xml.cc:244 NCCL WARN Unable to open ./results/Graph.txt, not dumping topology.
ault44:1048853:1048901 [0] NCCL INFO comm 0xbb4a490 rank 1 nRanks 2 nNodes 2 localRanks 1 localRank 0 MNNVL 0
ault43:1021351:1021412 [0] NCCL INFO comm 0xbb4d540 rank 0 nRanks 2 nNodes 2 localRanks 1 localRank 0 MNNVL 0
ault43:1021351:1021412 [0] NCCL INFO Channel 00/02 :    0   1
ault43:1021351:1021412 [0] NCCL INFO Channel 01/02 :    0   1
ault43:1021351:1021412 [0] NCCL INFO Trees [0] 1/-1/-1->0->-1 [1] -1/-1/-1->0->1
ault43:1021351:1021412 [0] NCCL INFO P2P Chunksize set to 131072
ault44:1048853:1048901 [0] NCCL INFO Trees [0] -1/-1/-1->1->0 [1] 0/-1/-1->1->-1
ault44:1048853:1048901 [0] NCCL INFO P2P Chunksize set to 131072
ault43:1021351:1021412 [0] NCCL INFO Channel 00/0 : 1[0] -> 0[0] [receive] via NET/IB/0
ault43:1021351:1021412 [0] NCCL INFO Channel 01/0 : 1[0] -> 0[0] [receive] via NET/IB/0
ault43:1021351:1021412 [0] NCCL INFO Channel 00/0 : 0[0] -> 1[0] [send] via NET/IB/0
ault44:1048853:1048901 [0] NCCL INFO Channel 00/0 : 0[0] -> 1[0] [receive] via NET/IB/0
ault44:1048853:1048901 [0] NCCL INFO Channel 01/0 : 0[0] -> 1[0] [receive] via NET/IB/0
ault44:1048853:1048901 [0] NCCL INFO Channel 00/0 : 1[0] -> 0[0] [send] via NET/IB/0
ault44:1048853:1048901 [0] NCCL INFO Channel 01/0 : 1[0] -> 0[0] [send] via NET/IB/0
ault43:1021351:1021412 [0] NCCL INFO Channel 01/0 : 0[0] -> 1[0] [send] via NET/IB/0
ault43:1021351:1021412 [0] NCCL INFO Connected all rings
ault44:1048853:1048901 [0] NCCL INFO Connected all rings
ault44:1048853:1048901 [0] NCCL INFO Connected all trees
ault43:1021351:1021412 [0] NCCL INFO Connected all trees
ault44:1048853:1048901 [0] NCCL INFO threadThresholds 8/8/64 | 16/8/64 | 512 | 512
ault44:1048853:1048901 [0] NCCL INFO 2 coll channels, 0 collnet channels, 0 nvls channels, 2 p2p channels, 2 p2p channels per peer
ault43:1021351:1021412 [0] NCCL INFO threadThresholds 8/8/64 | 16/8/64 | 512 | 512
ault43:1021351:1021412 [0] NCCL INFO 2 coll channels, 0 collnet channels, 0 nvls channels, 2 p2p channels, 2 p2p channels per peer
ault44:1048853:1048901 [0] NCCL INFO comm 0xbb4a490 rank 1 nranks 2 cudaDev 0 nvmlDev 0 busId 41000 commId 0x5d908c13e099cb61 - Init COMPLETE
ault43:1021351:1021412 [0] NCCL INFO comm 0xbb4d540 rank 0 nranks 2 cudaDev 0 nvmlDev 0 busId 41000 commId 0x5d908c13e099cb61 - Init COMPLETE
[2024-10-14 00:54:12,168] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[1/3] c++ -MMD -MF cpu_adam.o.d -DTORCH_EXTENSION_NAME=cpu_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1011\" -I/users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/includes -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/TH -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/THC -isystem /users/zhu/anaconda3/include/python3.12 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++17 -O3 -std=c++17 -g -Wno-reorder -L/apps/ault/spack/opt/spack/linux-centos8-zen/gcc-8.4.1/cuda-11.8.0-fjdnxm6yggxxp75sb62xrxxmeg4s24ml/lib64 -lcudart -lcublas -g -march=native -fopenmp -D__AVX256__ -D__ENABLE_CUDA__ -DBF16_AVAILABLE -c /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/adam/cpu_adam.cpp -o cpu_adam.o 
FAILED: cpu_adam.o 
c++ -MMD -MF cpu_adam.o.d -DTORCH_EXTENSION_NAME=cpu_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1011\" -I/users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/includes -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/TH -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/THC -isystem /users/zhu/anaconda3/include/python3.12 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++17 -O3 -std=c++17 -g -Wno-reorder -L/apps/ault/spack/opt/spack/linux-centos8-zen/gcc-8.4.1/cuda-11.8.0-fjdnxm6yggxxp75sb62xrxxmeg4s24ml/lib64 -lcudart -lcublas -g -march=native -fopenmp -D__AVX256__ -D__ENABLE_CUDA__ -DBF16_AVAILABLE -c /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/adam/cpu_adam.cpp -o cpu_adam.o 
In file included from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/core/TensorBase.h:14,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/core/TensorBody.h:38,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/core/Tensor.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/Tensor.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/function_hook.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/cpp_hook.h:2,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/variable.h:6,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/autograd.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include/torch/autograd.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include/torch/all.h:7,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/extension.h:5,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/includes/cpu_adam.h:12,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/adam/cpu_adam.cpp:6:
/users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/c10/util/C++17.h:13:2: error: #error "You're trying to build PyTorch with a too old version of GCC. We need GCC 9 or later."
 #error \
  ^~~~~
[2/3] c++ -MMD -MF cpu_adam_impl.o.d -DTORCH_EXTENSION_NAME=cpu_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1011\" -I/users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/includes -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/TH -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/THC -isystem /users/zhu/anaconda3/include/python3.12 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++17 -O3 -std=c++17 -g -Wno-reorder -L/apps/ault/spack/opt/spack/linux-centos8-zen/gcc-8.4.1/cuda-11.8.0-fjdnxm6yggxxp75sb62xrxxmeg4s24ml/lib64 -lcudart -lcublas -g -march=native -fopenmp -D__AVX256__ -D__ENABLE_CUDA__ -DBF16_AVAILABLE -c /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/adam/cpu_adam_impl.cpp -o cpu_adam_impl.o 
FAILED: cpu_adam_impl.o 
c++ -MMD -MF cpu_adam_impl.o.d -DTORCH_EXTENSION_NAME=cpu_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1011\" -I/users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/includes -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/TH -isystem /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/THC -isystem /users/zhu/anaconda3/include/python3.12 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++17 -O3 -std=c++17 -g -Wno-reorder -L/apps/ault/spack/opt/spack/linux-centos8-zen/gcc-8.4.1/cuda-11.8.0-fjdnxm6yggxxp75sb62xrxxmeg4s24ml/lib64 -lcudart -lcublas -g -march=native -fopenmp -D__AVX256__ -D__ENABLE_CUDA__ -DBF16_AVAILABLE -c /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/adam/cpu_adam_impl.cpp -o cpu_adam_impl.o 
In file included from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/core/TensorBase.h:14,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/core/TensorBody.h:38,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/core/Tensor.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/ATen/Tensor.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/function_hook.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/cpp_hook.h:2,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/variable.h:6,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/autograd/autograd.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include/torch/autograd.h:3,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/csrc/api/include/torch/all.h:7,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/torch/extension.h:5,
                 from /users/zhu/anaconda3/lib/python3.12/site-packages/deepspeed/ops/csrc/adam/cpu_adam_impl.cpp:6:
/users/zhu/anaconda3/lib/python3.12/site-packages/torch/include/c10/util/C++17.h:13:2: error: #error "You're trying to build PyTorch with a too old version of GCC. We need GCC 9 or later."
 #error \
  ^~~~~
ninja: build stopped: subcommand failed.
ault44:1048853:1048905 [0] NCCL INFO [Service thread] Connection closed by localRank 0
ault43:1021351:1021417 [0] NCCL INFO [Service thread] Connection closed by localRank 0
ault44:1048853:1048955 [0] NCCL INFO comm 0xbb4a490 rank 1 nranks 2 cudaDev 0 busId 41000 - Abort COMPLETE
ault43:1021351:1021456 [0] NCCL INFO comm 0xbb4d540 rank 0 nranks 2 cudaDev 0 busId 41000 - Abort COMPLETE
[2024-10-14 00:54:34,189] [INFO] [launch.py:319:sigkill_handler] Killing subprocess 1021351
[2024-10-14 00:54:34,189] [ERROR] [launch.py:325:sigkill_handler] ['/users/zhu/anaconda3/bin/python', '-u', 'train_bert_ds.py', '--local_rank=0', '--checkpoint_dir', '/users/zhu/DeepSpeedExamples/training/HelloDeepSpeed/experiment_deepspeed'] exits with return code = 1
[2024-10-14 00:54:34,322] [INFO] [launch.py:319:sigkill_handler] Killing subprocess 1048853
[2024-10-14 00:54:34,322] [ERROR] [launch.py:325:sigkill_handler] ['/users/zhu/anaconda3/bin/python', '-u', 'train_bert_ds.py', '--local_rank=0', '--checkpoint_dir', '/users/zhu/DeepSpeedExamples/training/HelloDeepSpeed/experiment_deepspeed'] exits with return code = 1
